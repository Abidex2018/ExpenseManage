@model ExpenseManager.Helper.ViewModels.RequisitionSearchObj
@{
    Layout = "~/Views/Shared/_MainLayout.cshtml";
}

<!DOCTYPE html>

<div class="panel-body" id="blockDiv">
    <form id="fetchTxnFrom" method="post" action="">
        @Html.Hidden("StartDate", Model.StartDate, new { @id = "txtStartDate" })
        @Html.Hidden("StopDate", Model.StopDate, new { @id = "txtStopDate" })
        <div class="row">
            <div class="col-md-3">
                <label class="control-label">Company</label>
                @Html.DropDownList("CompanyId", new SelectList(ViewBag.CompaniesLookup, "Id", "Name"), "-- Please select--", new { @id = "CompanyId", @class = "form-control nice-select" })
            </div>
            <div class="col-md-3">
                <label class="control-label">Department</label>
                @Html.DropDownList("DepartmentId", new SelectList(ViewBag.DepartmentsLookup, "Id", "Name"), "-- Please select--", new { @id = "DepartmentId", @class = "form-control nice-select" })
            </div>
            <div class="col-md-3">
                <div class="form-group">
                    <label>Date Ranges:</label>
                    <div class="input-group">
                        <input type="text" class="form-control " value="" id="daterange" name="daterange">
                        <span class="input-group-addon">
                            <span class="fa fa-calendar"></span>
                        </span>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <button type="button" class="btn btn-default" id="btnSearch" style="margin-top: 25px">
                    <i class="fa fa-search"></i> Search
                </button>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div id="partialList"></div>
            </div>
        </div>

    </form>

</div>
<script>

        $(document).ready(function () {


            var fromDate = moment().subtract(21, 'days');
            var toDate = moment();

            function displayDate(start, end) {
                $('#txtStartDate').val(start.format('DD/MM/YYYY'));
                $('#txtStartDate').val(end.format('DD/MM/YYYY'));
            }

            $('#daterange').daterangepicker(
                {
                    format: 'DD/MM/YYYY',
                    startDate: fromDate,
                    endDate: toDate,
                    ranges: {
                        'Today': [moment(), moment()],
                        'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
                        'Last 7 Days': [moment().subtract(6, 'days'), moment()],
                        'Last 30 Days': [moment().subtract(29, 'days'), moment()],
                        'This Month': [moment().startOf('month'), moment().endOf('month')],
                        'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
                    }
                },
                function (start, end, label) {
                    displayDate(start, end);
                    loadRequisitionList();
                }
            );

            displayDate(fromDate, toDate);

            $('#btnSearch').click(function () {

                loadRequisitionList();
            });



        });


        function loadRequisitionList() {

            //$('#blockDiv').block({
            //    css: { border: 'none', padding: '10px',
            //        backgroundColor: '#000','-webkit-border-radius': '10px','-moz-border-radius': '10px', opacity: .5, color: '#fff'
            //    }
            //});

            var frm = $("#fetchTxnFrom");
            var params = frm.serializeArray();

            $.ajax({

                type: "POST",
                url: '@Url.Action("PendingRequisitionList", "PendingRequisition")',
                data: params,
                success: function (data) {
                    $('#partialList').html(data);
                },
                complete: function () {
                    $('#blockDiv').unblock();
                }
            });


        }


</script>
